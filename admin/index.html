<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" type="image/png" href="favicon.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>
  <header>
    <nav>
      <div class="nav-links">
        <a href="/">Home</a>
        <a href="/projects/">Projects</a>
        <a href="/resume/">Resume</a>
        <a href="/admin.html">Admin</a>
      </div>
      <div class="toggle-switch">
        <label class="switch">
          <input type="checkbox" id="mode-toggle" />
          <span class="slider"></span>
        </label>
      </div>
    </nav>
  </header>

  <main class="admin-container">
    <h1>Admin Panel</h1>

    <form id="auth-form" class="admin-form">
      <label for="password">Admin Password:</label>
      <input type="password" id="password" placeholder="Enter admin password" required />
      <button type="submit">Login</button>
    </form>

    <section id="admin-panel" class="admin-hidden">
      <h2>Projects</h2>
      <div id="project-list"></div>

      <h3>Add New Project</h3>
      <form id="add-form" class="admin-form">
        <input type="text" id="title" placeholder="Title" required />
        <input type="text" id="type" placeholder="Type" required />
        <textarea id="description" placeholder="Description" required></textarea>
        <button type="submit">Add Project</button>
      </form>
    </section>
  </main>

  <script>
    // Dark Mode
    const toggle = document.getElementById("mode-toggle");
    if (localStorage.getItem("darkMode") === "enabled") {
      document.body.classList.add("dark-mode");
      toggle.checked = true;
    }
    toggle.addEventListener("change", () => {
      document.body.classList.toggle("dark-mode");
      localStorage.setItem("darkMode", document.body.classList.contains("dark-mode") ? "enabled" : "disabled");
    });

    // Admin Panel Logic
    const authForm = document.getElementById("auth-form");
    const adminPanel = document.getElementById("admin-panel");
    const passwordInput = document.getElementById("password");
    const projectList = document.getElementById("project-list");
    const addForm = document.getElementById("add-form");

    let adminPassword = "";

    authForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      adminPassword = passwordInput.value;
      try {
        const res = await fetch("https://portfolio-website-hyiq.onrender.com/admin/projects", {
          headers: { "X-Admin-Password": adminPassword }
        });
        if (!res.ok) throw new Error("Unauthorized");
        const projects = await res.json();
        document.getElementById("auth-form").style.display = "none";
        adminPanel.classList.remove("admin-hidden");
        renderProjects(projects);
      } catch (err) {
        alert("Incorrect password.");
      }
    });

    function renderProjects(projects) {
      projectList.innerHTML = "";
      projects.forEach(p => {
        const div = document.createElement("div");
        div.className = "project-card";
        div.innerHTML = `
          <h4>${p.title}</h4>
          <p><strong>${p.type}</strong></p>
          <p>${p.description}</p>
          <button onclick="deleteProject(${p.id})">Delete</button>
        `;
        projectList.appendChild(div);
      });
    }

    addForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const newProject = {
        title: document.getElementById("title").value,
        type: document.getElementById("type").value,
        description: document.getElementById("description").value,
      };
      const res = await fetch("https://portfolio-website-hyiq.onrender.com/admin/projects", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-Admin-Password": adminPassword,
        },
        body: JSON.stringify(newProject),
      });
      if (res.ok) location.reload();
      else alert("Error adding project.");
    });

    async function deleteProject(id) {
      const res = await fetch(`https://portfolio-website-hyiq.onrender.com/admin/projects/${id}`, {
        method: "DELETE",
        headers: { "X-Admin-Password": adminPassword },
      });
      if (res.ok) location.reload();
      else alert("Error deleting project.");
    }
  </script>
</body>
</html>
